import*as e from"source-map";import*as r from"path";import*as t from"fs";import*as n from"buffer-from";import i from"process";var o="default"in e?e.default:e;var a="default"in r?r.default:r;var u="default"in t?t.default:t;var s="default"in n?n.default:n;var l="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var c={};var f={exports:c};var p=i;var v=o.SourceMapConsumer;var m=a;var d;try{d=u;d.existsSync&&d.readFileSync||(d=null)}catch(e){}var g=s;
/**
 * Requires a module which is protected against bundler minification.
 *
 * @param {NodeModule} mod
 * @param {string} request
 */function dynamicRequire(e,r){return e.require(r)}var h=false;var S=false;var x=false;var E="auto";var y={};var w={};var b=/^data:application\/json[^,]+base64,/;var P=[];var R=[];function isInBrowser(){return"browser"===E||"node"!==E&&("undefined"!==typeof window&&"function"===typeof XMLHttpRequest&&!(window.require&&window.module&&window.process&&"renderer"===window.process.type))}function hasGlobalProcessEventEmitter(){return"object"===typeof p&&null!==p&&"function"===typeof p.on}function globalProcessVersion(){return"object"===typeof p&&null!==p?p.version:""}function globalProcessStderr(){if("object"===typeof p&&null!==p)return p.stderr}function globalProcessExit(e){if("object"===typeof p&&null!==p&&"function"===typeof p.exit)return p.exit(e)}function handlerExec(e){return function(r){for(var t=0;t<e.length;t++){var n=e[t](r);if(n)return n}return null}}var C=handlerExec(P);P.push((function(e){e=e.trim();/^file:/.test(e)&&(e=e.replace(/file:\/\/\/(\w:)?/,(function(e,r){return r?"":"/"})));if(e in y)return y[e];var r="";try{if(d)d.existsSync(e)&&(r=d.readFileSync(e,"utf8"));else{var t=new XMLHttpRequest;t.open("GET",e,false);t.send(null);4===t.readyState&&200===t.status&&(r=t.responseText)}}catch(e){}return y[e]=r}));function supportRelativeURL(e,r){if(!e)return r;var t=m.dirname(e);var n=/^\w+:\/\/[^\/]*/.exec(t);var i=n?n[0]:"";var o=t.slice(i.length);if(i&&/^\/\w\:/.test(o)){i+="/";return i+m.resolve(t.slice(i.length),r).replace(/\\/g,"/")}return i+m.resolve(t.slice(i.length),r)}function retrieveSourceMapURL(e){var r;if(isInBrowser())try{var t=new XMLHttpRequest;t.open("GET",e,false);t.send(null);r=4===t.readyState?t.responseText:null;var n=t.getResponseHeader("SourceMap")||t.getResponseHeader("X-SourceMap");if(n)return n}catch(e){}r=C(e);var i=/(?:\/\/[@#][\s]*sourceMappingURL=([^\s'"]+)[\s]*$)|(?:\/\*[@#][\s]*sourceMappingURL=([^\s*'"]+)[\s]*(?:\*\/)[\s]*$)/gm;var o,a;while(a=i.exec(r))o=a;return o?o[1]:null}var M=handlerExec(R);R.push((function(e){var r=retrieveSourceMapURL(e);if(!r)return null;var t;if(b.test(r)){var n=r.slice(r.indexOf(",")+1);t=g(n,"base64").toString();r=e}else{r=supportRelativeURL(e,r);t=C(r)}return t?{url:r,map:t}:null}));function mapSourcePosition(e){var r=w[e.source];if(!r){var t=M(e.source);if(t){r=w[e.source]={url:t.url,map:new v(t.map)};r.map.sourcesContent&&r.map.sources.forEach((function(e,t){var n=r.map.sourcesContent[t];if(n){var i=supportRelativeURL(r.url,e);y[i]=n}}))}else r=w[e.source]={url:null,map:null}}if(r&&r.map&&"function"===typeof r.map.originalPositionFor){var n=r.map.originalPositionFor(e);if(null!==n.source){n.source=supportRelativeURL(r.url,n.source);return n}}return e}function mapEvalOrigin(e){var r=/^eval at ([^(]+) \((.+):(\d+):(\d+)\)$/.exec(e);if(r){var t=mapSourcePosition({source:r[2],line:+r[3],column:r[4]-1});return"eval at "+r[1]+" ("+t.source+":"+t.line+":"+(t.column+1)+")"}r=/^eval at ([^(]+) \((.+)\)$/.exec(e);return r?"eval at "+r[1]+" ("+mapEvalOrigin(r[2])+")":e}function CallSiteToString(){var e;var r="";if(this.isNative())r="native";else{e=this.getScriptNameOrSourceURL();if(!e&&this.isEval()){r=this.getEvalOrigin();r+=", "}r+=e||"<anonymous>";var t=this.getLineNumber();if(null!=t){r+=":"+t;var n=this.getColumnNumber();n&&(r+=":"+n)}}var i="";var o=this.getFunctionName();var a=true;var u=this.isConstructor();var s=!(this.isToplevel()||u);if(s){var l=this.getTypeName();"[object Object]"===l&&(l="null");var c=this.getMethodName();if(o){l&&0!=o.indexOf(l)&&(i+=l+".");i+=o;c&&o.indexOf("."+c)!=o.length-c.length-1&&(i+=" [as "+c+"]")}else i+=l+"."+(c||"<anonymous>")}else if(u)i+="new "+(o||"<anonymous>");else if(o)i+=o;else{i+=r;a=false}a&&(i+=" ("+r+")");return i}function cloneCallSite(e){var r={};Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach((function(t){r[t]=/^(?:is|get)/.test(t)?function(){return e[t].call(e)}:e[t]}));r.toString=CallSiteToString;return r}function wrapCallSite(e,r){void 0===r&&(r={nextPosition:null,curPosition:null});if(e.isNative()){r.curPosition=null;return e}var t=e.getFileName()||e.getScriptNameOrSourceURL();if(t){var n=e.getLineNumber();var i=e.getColumnNumber()-1;var o=/^v(10\.1[6-9]|10\.[2-9][0-9]|10\.[0-9]{3,}|1[2-9]\d*|[2-9]\d|\d{3,}|11\.11)/;var a=o.test(globalProcessVersion())?0:62;1===n&&i>a&&!isInBrowser()&&!e.isEval()&&(i-=a);var u=mapSourcePosition({source:t,line:n,column:i});r.curPosition=u;e=cloneCallSite(e);var s=e.getFunctionName;e.getFunctionName=function(){return null==r.nextPosition?s():r.nextPosition.name||s()};e.getFileName=function(){return u.source};e.getLineNumber=function(){return u.line};e.getColumnNumber=function(){return u.column+1};e.getScriptNameOrSourceURL=function(){return u.source};return e}var l=e.isEval()&&e.getEvalOrigin();if(l){l=mapEvalOrigin(l);e=cloneCallSite(e);e.getEvalOrigin=function(){return l};return e}return e}function prepareStackTrace(e,r){if(x){y={};w={}}var t=e.name||"Error";var n=e.message||"";var i=t+": "+n;var o={nextPosition:null,curPosition:null};var a=[];for(var u=r.length-1;u>=0;u--){a.push("\n    at "+wrapCallSite(r[u],o));o.nextPosition=o.curPosition}o.curPosition=o.nextPosition=null;return i+a.reverse().join("")}function getErrorSource(e){var r=/\n    at [^(]+ \((.*):(\d+):(\d+)\)/.exec(e.stack);if(r){var t=r[1];var n=+r[2];var i=+r[3];var o=y[t];if(!o&&d&&d.existsSync(t))try{o=d.readFileSync(t,"utf8")}catch(e){o=""}if(o){var a=o.split(/(?:\r\n|\r|\n)/)[n-1];if(a)return t+":"+n+"\n"+a+"\n"+new Array(i).join(" ")+"^"}}return null}function printErrorAndExit(e){var r=getErrorSource(e);var t=globalProcessStderr();t&&t._handle&&t._handle.setBlocking&&t._handle.setBlocking(true);if(r){console.error();console.error(r)}console.error(e.stack);globalProcessExit(1)}function shimEmitUncaughtException(){var e=p.emit;p.emit=function(r){if("uncaughtException"===r){var t=arguments[1]&&arguments[1].stack;var n=this.listeners(r).length>0;if(t&&!n)return printErrorAndExit(arguments[1])}return e.apply(this||l,arguments)}}var O=P.slice(0);var N=R.slice(0);c.wrapCallSite=wrapCallSite;c.getErrorSource=getErrorSource;c.mapSourcePosition=mapSourcePosition;c.retrieveSourceMap=M;c.install=function(e){e=e||{};if(e.environment){E=e.environment;if(-1===["node","browser","auto"].indexOf(E))throw new Error("environment "+E+" was unknown. Available options are {auto, browser, node}")}if(e.retrieveFile){e.overrideRetrieveFile&&(P.length=0);P.unshift(e.retrieveFile)}if(e.retrieveSourceMap){e.overrideRetrieveSourceMap&&(R.length=0);R.unshift(e.retrieveSourceMap)}if(e.hookRequire&&!isInBrowser()){var r=dynamicRequire(f,"module");var t=r.prototype._compile;if(!t.__sourceMapSupport){r.prototype._compile=function(e,r){y[r]=e;w[r]=void 0;return t.call(this||l,e,r)};r.prototype._compile.__sourceMapSupport=true}}x||(x="emptyCacheBetweenOperations"in e&&e.emptyCacheBetweenOperations);if(!h){h=true;Error.prepareStackTrace=prepareStackTrace}if(!S){var n=!("handleUncaughtExceptions"in e)||e.handleUncaughtExceptions;try{var i=dynamicRequire(f,"worker_threads");false===i.isMainThread&&(n=false)}catch(e){}if(n&&hasGlobalProcessEventEmitter()){S=true;shimEmitUncaughtException()}}};c.resetRetrieveHandlers=function(){P.length=0;R.length=0;P=O.slice(0);R=N.slice(0);M=handlerExec(R);C=handlerExec(P)};var L=f.exports;const U=f.exports.install,T=f.exports.resetRetrieveHandlers;const F=f.exports.wrapCallSite,j=f.exports.getErrorSource,k=f.exports.mapSourcePosition,_=f.exports.retrieveSourceMap;export{L as default,j as getErrorSource,U as install,k as mapSourcePosition,T as resetRetrieveHandlers,_ as retrieveSourceMap,F as wrapCallSite};

